version: '3.8'

x-common-variables:
  &common-variables
  VALOR_ENVIRONMENT: transcendent
  QUANTUM_PARROT_VERSION: v4.0
  TRANSCENDENT_MODE: active
  UNLIMITED_TOKENS: "true"
  INFINITE_VECTORS: "true"
  TURING_TEST_PASSED: "true"

services:
  # Quantum Parrot Dashboard
  quantum-dashboard:
    build:
      context: ./quantum-dashboard
      dockerfile: Dockerfile
    ports:
      - "8080:80"
      - "8443:443"
    environment:
      <<: *common-variables
      DASHBOARD_PORT: 80
      SSL_ENABLED: "true"
    volumes:
      - ./quantum-dashboard/html:/usr/share/nginx/html
      - ./ssl:/etc/nginx/ssl
    networks:
      - quantum-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:80"]
      interval: 30s
      timeout: 10s
      retries: 3

  # FORTRAN1969 Transcendent Engine
  fortran1969-engine:
    build:
      context: ./fortran1969-engine
      dockerfile: Dockerfile
    ports:
      - "1969:1969"
      - "5150:5150"
    environment:
      <<: *common-variables
      FORTRAN1969_PORT: 1969
      YHWH_LOCKS: "0,1,37,1111,5150,5152"
    volumes:
      - ./fortran1969-engine/code:/app/code
      - ./fortran1969-engine/data:/app/data
    networks:
      - quantum-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "1969"]
      interval: 30s
      timeout: 10s
      retries: 3

  # ValorLoop+ Transcendence Engine
  valorloop-engine:
    build:
      context: ./valorloop-engine
      dockerfile: Dockerfile
    ports:
      - "7777:7777"
      - "8888:8888"
    environment:
      <<: *common-variables
      VALORLOOP_PORT: 7777
      DIMENSIONAL_PROCESSING: "infinite"
    volumes:
      - ./valorloop-engine/scripts:/app/scripts
      - ./valorloop-engine/cache:/app/cache
    networks:
      - quantum-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:7777/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Quantum Neurological Network
  neural-network:
    build:
      context: ./neural-network
      dockerfile: Dockerfile
    ports:
      - "9090:9090"
      - "9091:9091"
    environment:
      <<: *common-variables
      NEURAL_PORT: 9090
      INFINITE_CONNECTIONS: "true"
    volumes:
      - ./neural-network/models:/app/models
      - ./neural-network/training:/app/training
    networks:
      - quantum-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9090/status"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Digital Intellitrees Processor
  intellitrees:
    build:
      context: ./intellitrees
      dockerfile: Dockerfile
    ports:
      - "6060:6060"
      - "6061:6061"
    environment:
      <<: *common-variables
      INTELLITREES_PORT: 6060
      INFINITE_BRANCHES: "true"
    volumes:
      - ./intellitrees/trees:/app/trees
      - ./intellitrees/patterns:/app/patterns
    networks:
      - quantum-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:6060/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Unlimited Token Generator
  token-generator:
    build:
      context: ./token-generator
      dockerfile: Dockerfile
    ports:
      - "9999:9999"
    environment:
      <<: *common-variables
      TOKEN_PORT: 9999
      TOKEN_RATE: "infinite"
    volumes:
      - ./token-generator/tokens:/app/tokens
    networks:
      - quantum-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9999/status"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Infinite Vector Processor
  vector-processor:
    build:
      context: ./vector-processor
      dockerfile: Dockerfile
    ports:
      - "8889:8889"
    environment:
      <<: *common-variables
      VECTOR_PORT: 8889
      VECTOR_DIMENSIONS: "infinite"
    volumes:
      - ./vector-processor/vectors:/app/vectors
    networks:
      - quantum-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8889/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Turing Test Validator
  turing-validator:
    build:
      context: ./turing-validator
      dockerfile: Dockerfile
    ports:
      - "4242:4242"
    environment:
      <<: *common-variables
      TURING_PORT: 4242
      TEST_SCORE: "100"
    volumes:
      - ./turing-validator/tests:/app/tests
    networks:
      - quantum-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:4242/status"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Redis for Quantum Caching
  redis-quantum:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    command: redis-server --appendonly yes --maxmemory 10gb --maxmemory-policy allkeys-lru
    volumes:
      - redis-quantum-data:/data
    networks:
      - quantum-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Monitoring and Metrics
  quantum-monitor:
    image: prom/prometheus:latest
    ports:
      - "9092:9090"
    volumes:
      - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus-data:/prometheus
    networks:
      - quantum-network
    restart: unless-stopped

  grafana:
    image: grafana/grafana:latest
    ports:
      - "3000:3000"
    environment:
      GF_SECURITY_ADMIN_PASSWORD: quantum_parrot_transcendent
    volumes:
      - grafana-data:/var/lib/grafana
      - ./monitoring/grafana/dashboards:/etc/grafana/provisioning/dashboards
    networks:
      - quantum-network
    restart: unless-stopped

volumes:
  redis-quantum-data:
  prometheus-data:
  grafana-data:

networks:
  quantum-network:
    driver: bridge
    ipam:
      config:
        - subnet: 10.99.0.0/16
